{% extends "member/base.html" %}

{% load captureas %}
{% load emarkdown %}
{% load email_obfuscator %}
{% load date %}
{% load profile %}
{% load i18n %}
{% load interventions %}
{% load remove_url_scheme %}
{% load pluralize_fr %}
{% load crispy_forms_tags %}



{% block head_extra %}
    {{ block.super }}
    {% include "mathjax.html" %}
{% endblock %}


{% block title %}
    {{ usr.username }}
{% endblock %}


{% block body_class %}flexpage userprofilepage{% endblock %}


{% block sidebar_actions %}
    {% include "member/sidebar.html" %}
{% endblock %}


{% block content_out %}
    {% with public_tutos_count=profile.get_public_tutos.count articles_public_count=profile.get_public_articles.count opinions_public_count=profile.get_public_opinions.count opinions_draft_count=profile.get_draft_opinions.count draft_content_count=profile.get_draft_tutos.count|add:profile.get_draft_articles.count beta_tutos_count=profile.get_beta_tutos.count beta_articles_count=profile.get_beta_articles.count %}
        <section class="flexpage-header">
            <div class="flexpage-wrapper">
                <div class="flexpage-title-tool">
                    <div class="avatar">
                        <figure>
                            <img src="{{ profile.get_avatar_url|remove_url_scheme }}" />
                        </figure>
                    </div>

                    <div class="title">
                        <h1>{{ usr.username }}{% include 'misc/badge.part.html' with member=usr long_badge=True %}</h1>

                        {% for summary in summaries %}
                            <div class="line">
                                <div class="line-item">
                                    <span class="has-separator">{{ summary }}</span>
                                </div>
                            </div>
                        {% endfor %}

                        <div class="aside">
                            <form action="{% url 'search:query' %}" id="search-member-form" class="search" method="get">
                                {% csrf_token %}
                                <label for="id_q" class="control-label">{% trans 'Recherche' %}</label>
                                <input id="id_q" maxlength="150" name="q" required="required" type="search" placeholder="dans l'activité du membre (prochainement)" readonly>
                                <input type="hidden" name="models" value="content">
                                <button class="btn ico-after ico-search" type="submit" title="{% trans 'Rechercher' %}"></button>
                            </form>
                        </div>
                    </div>

                    {% if not profile.is_private and user.is_authenticated %}
                        <div class="actions">
                            {% if profile.user == user %}
                                <a href="{% url "update-member" %}"  title="{% trans "Modifier mon profil" %}" class="btn-ico btn ico-after gear light">
                                    {% trans "Modifier mon profil" %}
                                </a>
                            {% elif perms.member.change_profile %}
                                <a href="{% url "member-settings-mini-profile" profile.user.username %}"  title="{% trans "Modifier le profil" %}" class="btn-ico btn ico-after gear light">
                                    {% trans "Modifier le profil" %}
                                </a>
                            {% endif %}
                            {% if usr != user %}
                                <a href="{% url 'mp-new' %}?username={{ usr.username }}" class="btn-ico btn ico-after cite light">
                                    {% trans "Envoyer un message" %}
                                </a>
                            {% endif %}
                            {% with content_is_followed=usr|is_new_publication_followed content_is_followed_email=usr|is_new_publication_email_followed %}
                                {% url 'content:follow' usr.pk as link_follow %}
                                {% if content_is_followed %}
                                    {% trans "S'abonner" as data_onclick %}
                                    {% trans "Abonné" as button_text %}
                                {% else %}
                                    {% trans "S'abonner" as button_text %}
                                    {% trans "Abonné" as data_onclick %}
                                {% endif %}

                                {% if content_is_followed_email %}
                                    {% trans "S'abonner par courriel" as email_data_onclick %}
                                    {% trans "Abonné par courriel" as email_button_text %}
                                {% else %}
                                    {% trans "S'abonner par courriel" as email_button_text %}
                                    {% trans "Abonné par courriel" as email_data_onclick %}
                                {% endif %}

                                {% include 'notification/follow_button_combined_template.html' with link=link_follow is_followed=content_is_followed data_onclick=data_onclick button_text=button_text is_followed_email=content_is_followed_email email_data_onclick=email_data_onclick email_button_text=email_button_text followed_user=usr user=user %}
                            {% endwith %}
                            {% comment %}
                                <a href="#report-profile" class="btn-ico btn ico-after alert light open-modal">
                                    {% trans "Signaler ce profil" %}
                                </a>
                                <form action="{% url 'report-profile' profile.pk %}" method="post" id="report-profile" class="modal modal-flex">
                                    {% csrf_token %}
                                    <label for="report-reason">
                                        {% trans "Pour quelle raison signalez-vous ce profil ?" %}
                                    </label>
                                    <textarea type="text" name="reason" id="report-reason" placeholder='{% trans "Spam, Contenu illégal, …" %}' pattern=".{3,}" required title='{% trans "Minimum 3 caractères pour signaler" %}' rows="4"></textarea>

                                    <button type="submit">
                                        {% trans "Signaler" %}
                                    </button>
                                </form>
                            {% endcomment %}
                        </div>
                    {% endif %}
                </div>
            </div>
        </section>

        <div class="flexpage-wrapper">
            <div class="subheader">
                <p class="presence-statistics">
                    {% if profile.is_private %}
                        {% trans "Ce membre est un compte d'administration" %}
                    {% else %}
                        {% trans "Inscription le" %} <time datetime="{{ usr.date_joined|date:"c" }}">{{ usr.date_joined|format_date:True }}</time> —
                        {% if profile.last_visit %}
                            {% trans "Dernière visite" %} <time datetime="{{ profile.last_visit|date:"c" }}">{{ profile.last_visit|format_date:True }}</time>
                        {% else %}
                            {% trans "Ne s’est jamais connecté(e)" %}
                        {% endif %}
                    {% endif %}
                </p>

                {% if profile.has_hat or perms.utils.change_hat %}
                    <ul class="hatlist">
                        {% for hat in profile.get_hats %}
                            <li class="hat {% if hat.is_staff %}staff-hat{% endif %}">
                                <a class="name" href="{{ hat.get_absolute_url }}" rel="casquette">
                                    {{ hat.name }}
                                    {% if hat.is_staff %}
                                        ({{ app.site.literal_name }})
                                    {% endif %}
                                </a>
                                {% if perms.utils.change_hat and not hat.group %}
                                    <a href="#remove-hat-{{ hat.pk }}" class="open-modal">{% trans "Retirer" %}</a>
                                    <form action="{% url 'remove-hat' usr.pk hat.pk %}" method="post" id="remove-hat-{{ hat.pk }}" class="modal modal-flex">
                                        {% csrf_token %}
                                        <p>
                                            {% blocktrans with hat=hat.name username=usr.username %}
                                                Voulez-vous vraiment retirer la casquette « {{ hat }} » à {{ username }} ?
                                            {% endblocktrans %}
                                        </p>
                                        <button type="submit">{% trans 'Confirmer' %}</button>
                                    </form>
                                {% endif %}
                            </li>
                        {% endfor %}
                        {% if perms.utils.change_hat %}
                            <li>
                                <a href="#add-hat" class="open-modal btn btn-grey ico-after more"><span class="{% if profile.has_hat %}a11y{% endif %}">{% trans "Ajouter une casquette" %}</span></a>
                                <form action="{% url 'add-hat' usr.pk %}" method="post" id="add-hat" class="modal modal-flex">
                                    {% csrf_token %}
                                    <p>
                                        {% blocktrans with username=usr.username %}Vous allez ajouter une casquette à {{ username }} :{% endblocktrans %}
                                    </p>
                                    <ul>
                                        <li>{% trans "Le membre aura la possibilité pour chaque message de poster avec ou sans sa casquette." %}</li>
                                        <li>{% trans "Il sera possible de retirer la casquette au membre par la suite. Les messages ayant été postés avec le resteront." %}</li>
                                    </ul>
                                    <p>{% trans "La casquette sera créée si elle n’existe pas." %}</p>
                                    <input type="text" name="hat" maxlength="40" placeholder="{% trans 'Casquette à attribuer.' %}" required>
                                    <button type="submit">{% trans 'Valider' %}</button>
                                </form>
                            </li>
                        {% endif %}
                    </ul>
                {% endif %}
            </div>

            <section class="user-bio-and-activity">
                <div class="bio">
                    <div class="bio-container">
                        <div class="message-content">
                            {% if not profile.end_ban_read and not profile.can_read %}
                                <div class="no-bio">{% trans "La biographie de ce membre est masquée car il a été banni définitivement." %}</div>
                            {% elif profile.biography %}
                                {{ profile.biography|emarkdown }}
                            {% else %}
                                <div class="no-bio">
                                {% if usr != user %}
                                    {% trans "Cet utilisateur n'a pas rédigé de biographie." %}
                                {% else %}
                                    {% trans "Vous n'avez pas encore rédigé de biographie." %}<br />
                                    <a href="{% url "update-member" %}">{% trans "Voulez-vous en écrire une pour vous présenter à la communauté ?" %}</a>
                                {% endif %}
                                </div>
                            {% endif %}
                        </div>
                        {% if profile.sign %}
                            <div class="message-bottom">
                                <div class="signature">
                                    {% if not profile.end_ban_read and not profile.can_read %}
                                        <em>{% trans "La signature de ce membre est masquée car il a été banni définitivement." %}</em>
                                    {% else %}
                                        {{ profile.sign|emarkdown_inline }}
                                    {% endif %}
                                </div>
                            </div>
                        {% endif %}
                    </div>
                </div>

                <div class="activity">
                    <div class="content-linkbox-list">
                        {% if profile.end_ban_read or profile.can_read %}
                            {% if profile.site or profile.show_email %}
                                <div class="linkbox-item primary">
                                    {% if profile.site %}
                                        <a href="{{ profile.site }}" class="tail" rel="me nofollow">
                                            {% trans "Voir son site web" %}
                                        </a>
                                    {% endif %}
                                    {% if profile.show_email and user.is_authenticated %}
                                        <a href="mailto:{{ usr.email|obfuscate }}" class="tail">
                                            {% trans "Envoyer un courriel" %}
                                        </a>
                                    {% endif %}
                                </div>
                            {% endif %}
                        {% else %}
                            <div class="linkbox-item secondary">
                                <span class="tail">{% trans "Ce membre a été banni définitivement." %}</span>
                            </div>
                        {% endif %}

                        {% if public_tutos_count > 0 or articles_public_count > 0 or opinions_public_count > 0 %}
                            <div class="linkbox-item primary">
                                <div class="head">
                                    <h3>{% trans 'Contenus' %}</h3>
                                </div>

                                {% if public_tutos_count > 0 %}
                                    <a href="{% url "content:find-tutorial" usr.pk %}?filter=public" class="tail">
                                        <p>
                                            {% blocktrans count public_tutos_count=public_tutos_count %}
                                                {{ public_tutos_count }} tutoriel publié
                                            {% plural %}
                                                {{ public_tutos_count }} tutoriaux publiés
                                            {% endblocktrans %}
                                        </p>
                                    </a>
                                {% endif %}

                                {% if articles_public_count > 0 %}
                                    <a href="{% url "content:find-article" usr.pk %}?filter=public" class="tail">
                                        <p>
                                            {% blocktrans count articles_public_count=articles_public_count %}
                                                {{ articles_public_count }} article publié
                                            {% plural %}
                                                {{ articles_public_count }} articles publiés
                                            {% endblocktrans %}
                                        </p>
                                    </a>
                                {% endif %}

                                {% if opinions_public_count > 0 %}
                                    <a href="{% url "content:find-opinion" usr.pk %}?filter=public" class="tail">
                                        <p>
                                            {% blocktrans count opinions_public_count=opinions_public_count %}
                                                {{ opinions_public_count }} billet publié
                                            {% plural %}
                                                {{ opinions_public_count }} billets publiés
                                            {% endblocktrans %}
                                        </p>
                                    </a>
                                {% endif %}
                            </div>
                        {% endif %}

                        {% if profile.end_ban_read or profile.can_read %}
                            {% if beta_tutos_count > 0 or beta_articles_count > 0 %}
                                <div class="linkbox-item secondary">
                                    <div class="head">
                                        <h3>{% trans 'En bêta' %}</h3>
                                    </div>

                                    <div class="body">
                                        <p>
                                            {% trans "Aidez à peaufiner le fond et la forme de ces contenus en cours de rédaction" %}
                                        </p>
                                    </div>

                                    {% if beta_tutos_count > 0 %}
                                        <a href="{% url "content:find-tutorial" usr.pk %}?filter=beta" class="tail">
                                                <p>
                                                    {% blocktrans count beta_tutos_count=beta_tutos_count %}
                                                        {{ beta_tutos_count }} tutoriel en bêta
                                                    {% plural %}
                                                        {{ beta_tutos_count }} tutoriaux en bêta
                                                    {% endblocktrans %}
                                                </p>
                                            </a>
                                    {% endif %}

                                    {% if beta_articles_count > 0 %}
                                        <a href="{% url "content:find-article" usr.pk %}?filter=beta" class="tail">
                                            <p>
                                                {% blocktrans count beta_articles_count=beta_articles_count %}
                                                    {{ beta_articles_count }} article en bêta
                                                {% plural %}
                                                    {{ beta_articles_count }} articles en bêta
                                                {% endblocktrans %}
                                            </p>
                                        </a>
                                    {% endif %}
                                </div>
                            {% endif %}
                        {% endif %}

                        <div class="linkbox-item primary">
                            <div class="head">
                                <h3>{% trans 'Forum' %}</h3>
                            </div>

                            <a href="{% url 'topic-find' usr.pk %}" class="tail">
                                <p>
                                    {% blocktrans count topics_count=profile.get_topic_count %}
                                        {{ topics_count }} sujet créé
                                    {% plural %}
                                        {{ topics_count }} sujets créés
                                    {% endblocktrans %}
                                </p>
                            </a>

                            <a href="{% url 'post-find' usr.pk %}" class="tail">
                                {% captureas messages_count %}{% if perms.member.change_post %}{{ profile.get_post_count_as_staff }}{% else %}{{ profile.get_post_count }}{% endif %}{% endcaptureas %}
                                <p>
                                    {% blocktrans count messages_count=messages_count|add:"0" %}
                                        {{ messages_count }} message posté
                                    {% plural %}
                                        {{ messages_count }} messages postés
                                    {% endblocktrans %}
                                </p>
                            </a>
                        </div>
                    </div>
                </div>
            </section>

            <div class="flexpage-column">
                <section>
                    <h2 itemprop="name">
                        {% trans 'Dernières publications' %}
                    </h2>
                    {% if articles_and_tutorials %}
                        <div class="content-item-list">
                            {% for public_content in articles_and_tutorials %}
                                {% include 'tutorialv2/includes/content_item.part.html' with show_description=True public_content=public_content %}
                            {% endfor %}
                        </div>
                    {% else %}
                        <p>{% trans "Aucune publication." %}</p>
                    {% endif %}
                </section>
                <section>
                    <h2 itemprop="name">
                      {% trans 'Derniers billets publiés' %}
                        <a href="{% url "content:find-opinion" usr.pk %}?filter=public" class="btn btn-grey">{% trans 'Voir tout' %}</a>
                    </h2>

                    {% if opinions %}
                        <div class="content-item-list">
                            {% for public_opinion in opinions %}
                                {% include 'tutorialv2/includes/content_item.part.html' with show_description=True public_content=public_opinion show_reactions=True %}
                            {% endfor %}
                        </div>
                    {% else %}
                        <p>{% trans "Aucun billet publié." %}</p>
                    {% endif %}
                </section>
            </div>

            <section>
                <h2 itemprop="name">
                    {% trans 'Derniers sujets crées' %}
                    <a href="{% url 'topic-find' usr.pk %}" class="btn btn-grey">{% trans 'Voir tout' %}</a>
                </h2>

                {% if topics %}
                    <div class="content-item-list">
                        {% for topic in topics %}
                            {% include 'forum/includes/topic_item.part.html' %}
                            {% if forloop.last %}
                                <span class="fill">
                            {% endif %}
                        {% endfor %}
                    </div>
                {% else %}
                    <p>{% trans "Aucun sujet créé." %}</p>
                {% endif %}
            </section>

            {% if perms.member.change_profile and profile.user.is_active %}
                <section>
                    <h2 itemprop="name">{% trans 'Administration et Modération' %}</h2>
                    <div class="content-linkbox-list">
                        {% if user.is_superuser %}
                            <div class="linkbox-item">

                                <div class="head">
                                    <h3>{% trans 'Actions super-utilisateur' %}</h3>
                                </div>
                                <a href="{% url "member-settings-promote" profile.user.pk %}" class="tail">
                                    <p>{% trans "Gestion des groupes" %}</p>
                                </a>
                                {% if user.is_staff %}
                                <a href="{% url 'admin:auth_user_change' profile.user.pk %}" class="tail">
                                    <p>{% trans "Administration de Django" %}</p>
                                </a>
                                {% endif %}
                            </div>
                        {% endif %}
                        <div class="linkbox-item">
                            <div class="head">
                                <h3>{% trans 'Statistiques' %}</h3>
                            </div>

                            <span class="tail">
                                <p>{% trans "Messages modérés" %} : {{ profile.get_hidden_by_staff_posts_count }}</p>
                            </span>
                            <span class="tail">
                                <p>{% trans "Alertes actives" %} : {{ profile.get_active_alerts_count }}</p>
                            </span>
                        </div>
                        {% if perms.member.show_ip %}
                        <div class="linkbox-item">
                            <div class="head">
                                <h3>{% trans 'Adresse IP' %}</h3>
                            </div>
                            
                            <span class="tail">
                                <p>{% trans "Dernière adresse IP" %} : {{ profile.last_ip_address }}</p>
                            </span>
                            {% if profile.get_city %}
                            <span class="tail">
                                <p>{% trans "Ville associée" %} : {{ profile.get_city }}</p>
                            </span>
                            {% endif %}
                            <a href="{% url "member-from-ip" profile.last_ip_address %}" class="tail">
                                <p>{% trans "Voir tous les membres avec cette IP" %}</p>
                            </a>
                        </div>
                        {% endif %}

                        {% if not profile.is_private %}
                        <div class="linkbox-item">
                            <div class="head">
                                <h3>{% trans 'Karma' %}</h3>
                            </div>

                            <span class="tail">
                                <p>{% trans "Valeur actuelle" %} : {{ profile.karma }}</p>
                            </span>
                            <a href="#karmatiser-modal" class="tail open-modal">
                                <p>{% trans "Ajouter une remarque" %}</p>
                            </a>
                            {% crispy karmaform %}
                        </div>
                        {% endif %}

                        {% if not profile.is_private and usr != user %}
                        <div class="linkbox-item">
                            <div class="head">
                                <h3>{% trans 'Sanctions' %}</h3>
                            </div>
                            {% if profile.can_write_now %}
                                <a href="#ls-temp-{{ profile.pk }}" class="open-modal tail">
                                    <p>{% trans "Lecture seule temporaire" %}</p>
                                </a>
                                <form action="{% url "member-modify-profile" profile.user.pk %}"
                                      method="post"
                                      id="ls-temp-{{ profile.pk }}"
                                      class="modal modal-flex">
                                    <p>
                                        {% blocktrans %}
                                            Pour quelle raison souhaitez-vous mettre ce membre en lecture seule <em>temporairement</em> ?
                                        {% endblocktrans %}
                                    </p>
                                    <input type="text"
                                           name="ls-text"
                                           class="expand"
                                           placeholder="{% trans 'Spam, Troll, etc.' %}">
                                    <input type="number"
                                           name="ls-jrs"
                                           class="expand"
                                           placeholder="{% trans 'Durée de la lecture seule, en jours' %}"
                                           min="1">
                                    {% csrf_token %}
                                    <button type="submit"
                                            name="ls-temp">
                                        {% trans "Confirmer" %}
                                    </button>
                                </form>
                                <a href="#ls-{{ profile.pk }}" class="open-modal tail">
                                    <p>{% trans "Lecture seule" %}</p>
                                </a>
                                <form action="{% url "member-modify-profile" profile.user.pk %}"
                                      method="post"
                                      id="ls-{{ profile.pk }}"
                                      class="modal modal-flex">
                                    <p>
                                        {% trans "Pour quelle raison souhaitez-vous mettre ce membre en lecture seule" %} ?
                                    </p>
                                    <input type="text"
                                           name="ls-text"
                                           class="expand"
                                           placeholder="{% trans 'Spam, Troll, etc.' %}">
                                    {% csrf_token %}
                                    <button type="submit"
                                            name="ls">
                                        {% trans "Confirmer" %}
                                    </button>
                                </form>
                            {% else %}
                                <a href="#ls-temp-{{ profile.pk }}" class="open-modal tail">
                                    <p>{% trans "Ôter la lecture seule" %}</p>
                                </a>
                                <form action="{% url "member-modify-profile" profile.user.pk %}"
                                      method="post"
                                      id="ls-temp-{{ profile.pk }}"
                                      class="modal modal-flex">
                                    <p>
                                        {% blocktrans %}
                                            Pour quelle raison souhaitez-vous <strong>lever la sanction</strong> de ce membre ?
                                        {% endblocktrans %}
                                    </p>
                                    <input type="text"
                                           name="unls-text"
                                           class="expand"
                                           placeholder="{% trans 'Bonne action ?' %}">
                                    {% csrf_token %}
                                    <button type="submit"
                                            name="un-ls">
                                        {% trans "Confirmer" %}
                                    </button>
                                </form>
                            {% endif %}

                            {% if profile.can_read_now %}
                                <a href="#ban-temp-{{ profile.pk }}" class="open-modal tail">
                                    <p>{% trans "Bannir temporairement" %}</p>
                                </a>
                                <form action="{% url "member-modify-profile" profile.user.pk %}"
                                      method="post"
                                      id="ban-temp-{{ profile.pk }}"
                                      class="modal modal-flex">
                                    <p>
                                        {% blocktrans %}
                                            Pour quelle raison souhaitez-vous bannir ce membre <em>temporairement</em> ?
                                        {% endblocktrans %}
                                    </p>
                                    <input type="text"
                                           name="ban-text"
                                           class="expand"
                                           placeholder="{% trans 'Spam, Troll, etc.' %}">
                                    <input type="number"
                                           name="ban-jrs"
                                           class="expand"
                                           placeholder="{% trans 'Durée du bannissement, en jours' %}"
                                           min="1">
                                    {% csrf_token %}
                                    <button type="submit"
                                            name="ban-temp">
                                        {% trans "Confirmer" %}
                                    </button>
                                </form>
                                <a href="#ban-{{ profile.pk }}" class="open-modal tail">
                                    <p>{% trans "Bannir définitivement" %}</p>
                                </a>
                                <form action="{% url "member-modify-profile" profile.user.pk %}"
                                      method="post"
                                      id="ban-{{ profile.pk }}"
                                      class="modal modal-flex">
                                    <p>
                                        {% trans "Pour quelle raison souhaitez-vous bannir ce membre" %} ?
                                    </p>
                                    <input type="text"
                                           name="ban-text"
                                           class="expand"
                                           placeholder="{% trans 'Spam, Troll, etc.' %}">
                                    {% csrf_token %}
                                    <button type="submit"
                                            name="ban">
                                        {% trans "Confirmer" %}
                                    </button>
                                </form>
                            {% else %}
                            <a href="#unban-{{ profile.pk }}" class="open-modal tail">
                                <p>{% trans "Ôter le bannissement" %}</p>
                            </a>
                            <form action="{% url "member-modify-profile" profile.user.pk %}"
                                  method="post"
                                  id="unban-{{ profile.pk }}"
                                  class="modal modal-flex">
                                <p>
                                    {% trans "Pour quelle raison souhaitez vous lever la sanction de ce membre" %} ?
                                </p>
                                <input type="text"
                                       name="unban-text"
                                       class="expand"
                                       placeholder="{% trans 'Bonne action ?' %}">
                                {% csrf_token %}
                                <button type="submit"
                                        name="un-ban">
                                    {% trans "Confirmer" %}
                                </button>
                            </form>
                            {% endif %}
                        </div>
                        {% endif %}
                    </div>
                </section>
            {% endif %}

            {% if perms.member.change_profile and actions %}
                <section id="historique-moderation">
                    <h2 itemprop="name">{% trans 'Historique de modération' %}</h2>
                    <table class="fullwidth">
                        <thead>
                            <th>{% trans "Action" %}</th>
                            <th>{% trans "Explication" %}</th>
                            <th class="wide">{% trans "Modérateur" %}</th>
                            <th class="wide">{% trans "Date" %}</th>
                        </thead>
                        <tbody>
                            {% for action in actions %}
                                <tr>
                                    <td>
                                        {% if action.type %}
                                            {{ action.type }}
                                        {% elif action.karma %}
                                            {% trans "Modification du karma" %} : {{ action.karma }}
                                        {% else %}
                                            –
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if action.note %}
                                            {{ action.note }}
                                        {% else %}
                                            –
                                        {% endif %}
                                    </td>
                                    <td class="wide"><a href="{% url "member-detail" action.moderator.username %}">{{ action.moderator.username }}</a></td>
                                    <td class="wide">{{ action.pubdate|format_date|capfirst }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </section>
            {% endif %}
            
            {% if perms.member.change_profile and alerts %}
                <section id="alerts">
                    <h2 itemprop="name">{% trans "Signalements du profil" %}</h2>
                    {% for alert in alerts %}
                        <div class="alert-box{% if not alert.solved %} error{% endif %}">
                            {{ alert.pubdate|format_date|capfirst }} {% trans "par" %}
                            {% include "misc/member_item.part.html" with member=alert.author %} :
                            <em class="alert-box-text">{{ alert.text }}</em>
                            {% if alert.solved %}
                                <span class="close-alert-box close-alert-box-text">
                                    {% trans "Résolu par" %}
                                    {% include "misc/member_item.part.html" with member=alert.moderator %}
                                </span>
                            {% else %}
                                <a href="#solve-alert-{{ alert.pk }}" class="open-modal close-alert-box close-alert-box-text">{% trans "Résoudre" %}</a>
                                <form id="solve-alert-{{ alert.pk }}" method="post" action="{% url 'solve-profile-alert' alert.pk %}" class="modal modal-flex">
                                    <textarea name="text" class="input" placeholder="{% trans 'Message à envoyer au membre ayant lancé l’alerte' %}"></textarea>
                                    {% csrf_token %}
                                    <button type="submit" class="button expand alert tiny">{% trans "Résoudre l’alerte" %}</button>
                                </form>
                            {% endif %}
                        </div>
                    {% endfor %}
                </section>
            {% endif %}

            <section class="report-profile">
                <a href="#report-profile" class="open-modal">
                    {% trans "Signaler ce profil" %}
                </a>
                <form action="{% url 'report-profile' profile.pk %}" method="post" id="report-profile" class="modal modal-flex">
                    {% csrf_token %}
                    <label for="report-reason">
                        {% trans "Pour quelle raison signalez-vous ce profil ?" %}
                    </label>
                    <textarea type="text" name="reason" id="report-reason" placeholder='{% trans "Spam, Contenu illégal, …" %}' pattern=".{3,}" required title='{% trans "Minimum 3 caractères pour signaler" %}' rows="4"></textarea>

                    <button type="submit">
                        {% trans "Signaler" %}
                    </button>
                </form>
            </section>
        </div>
    {% endwith %}
{% endblock %}
