{% extends "base.html" %}
{% load i18n %}
{% load date %}


{% block title %}
    {% trans "Notifications" %}
{% endblock %}



{% block breadcrumb %}
    <li>{% trans "Notifications" %}</li>
{% endblock %}



{% block headline %}
    {% trans "Notifications" %}
{% endblock %}



{% block content %}
    {% include "misc/paginator.html" with position="top" %}

    {% if notifications %}
        <div class="notification-list navigable-list">
            {% for notification in notifications %}
                <div class="notification navigation-elem {% if not notification.is_read %}unread{% endif %}">
                    <div class="notification-infos">
                        {# In the future, we'll add the icon of the notification. #}
                    </div>
                    <div class="notification-description">
                        <a href="{{ notification.url }}" class="notification-title-link navigable-link"
                           title="{{ notification.title }}">
                            <h4 class="notification-title" itemprop="itemListElement">{{ notification.title }}</h4>
                        </a>
                    </div>
                    <p class="notification-last-answer">
                        <span class="notification-last-answer-short-date">{{ notification.pubdate|format_date:True|capfirst }}</span>
                        <span class="notification-last-answer-long-date">{{ notification.pubdate|format_date|capfirst }}</span>
                        <span class="notification-last-answer-author">
                            {% trans "par" %}
                            {% include "misc/member_item.part.html" with member=notification.sender %}
                        </span>
                    </p>
                </div>
            {% endfor %}
        </div>
    {% else %}
        {% trans "Vous n'avez pas encore de notification." %}
    {% endif %}

    {% include "misc/paginator.html" with position="bottom" %}
{% endblock %}



{% block sidebar %}
    <aside class="sidebar mobile-menu-hide">
        <div class="mobile-menu-bloc mobile-all-links mobile-show-ico" data-title="Actions">
            <h3>{% trans "Actions" %}</h3>
            <ul>
                <li>
                    <a href="#mark-notifications-as-read" class="open-modal ico-after tick green">{% trans 'Tout marquer comme lu' %}</a>
                        <form action="{% url 'mark-notifications-as-read' %}" method="post" id="mark-notifications-as-read" class="modal modal-flex">
                            {% csrf_token %}
                            <p>
                                {% trans 'Voulez-vous vraiment marquer toutes vos notifications comme lues ?' %}
                            </p>
                            <button type="submit">{% trans 'Confirmer' %}</button>
                    </form>
                </li>
            </ul>
        </div>

        <div class="mobile-menu-bloc mobile-all-links mobile-show-ico" data-title="Abonnements">
            <h3>{% trans "Abonnements" %}</h3>
            <ul>
                <li>
                    <a href="#followed-users" class="open-modal">{% trans 'Membres suivis' %}</a>
                        <div id="followed-users" class="modal modal-flex" data-modal-close="{% trans 'Fermer' %}">
                            {% if followed_users %}
                                <table class="fullwidth">
                                    <thead>
                                        <th>{% trans "Membre" %}</th>
                                        <th width="100px">{% trans "Par courriel" %}</th>
                                    </thead>
                                    <tbody>
                                        {% for user in followed_users %}
                                            <tr>
                                                <td>{% include "misc/member_item.part.html" with member=user.content_object %}</td>
                                                <td>{{ user.by_email|yesno:_('Oui,Non') }}</td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            {% else %}
                                <p>{% trans "Vous ne suivez aucun membre." %}</p>
                            {% endif %}
                        </div>
                    </form>
                </li>

                <li>
                    <a href="#followed-forums" class="open-modal">{% trans 'Forums suivis' %}</a>
                        <div id="followed-forums" class="modal modal-flex" data-modal-close="{% trans 'Fermer' %}">
                            {% if followed_forums %}
                                <table class="fullwidth">
                                    <thead>
                                        <th>{% trans "Forum" %}</th>
                                        <th width="100px">{% trans "Par courriel" %}</th>
                                    </thead>
                                    <tbody>
                                        {% for forum in followed_forums %}
                                            <tr>
                                                <td>
                                                    <a href="{{ forum.content_object.get_absolute_url }}">
                                                        {{ forum.content_object.title }}
                                                    </a>
                                                </td>
                                                <td>{{ forum.by_email|yesno:_('Oui,Non') }}</td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            {% else %}
                                <p>{% trans "Vous ne suivez aucun forum." %}</p>
                            {% endif %}
                        </div>
                    </form>
                </li>

                <li>
                    <a href="#followed-tags" class="open-modal">{% trans 'Tags suivis' %}</a>
                        <div id="followed-tags" class="modal modal-flex" data-modal-close="{% trans 'Fermer' %}">
                            {% if followed_tags %}
                                <table class="fullwidth">
                                    <thead>
                                        <th>{% trans "Tag" %}</th>
                                        <th width="100px">{% trans "Par courriel" %}</th>
                                    </thead>
                                    <tbody>
                                        {% for tag in followed_tags %}
                                            <tr>
                                                <td>
                                                    <a href="{{ tag.content_object.get_absolute_url }}">
                                                        {{ tag.content_object.title }}
                                                    </a>
                                                </td>
                                                <td>{{ tag.by_email|yesno:_('Oui,Non') }}</td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            {% else %}
                                <p>{% trans "Vous ne suivez aucun tag." %}</p>
                            {% endif %}
                        </div>
                    </form>
                </li>
            </ul>
        </div>
    </aside>
{% endblock %}
