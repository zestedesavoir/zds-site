{% extends "article/base.html" %}
{% load emarkdown %}
{% load markup %}
{% load humane_date %}
{% load profile %}

{% block title %}
    {{ article.title }}
{% endblock %}

{% block headline %}
    <a href="{{ article.get_absolute_url }}">{{ article.title }}</a><br />
    <small>{{ article.description }}</small>
{% endblock %}

{% block breadcrumb %}
    <li class="current"><a href="#">{{ article.title }}</a></li>
{% endblock %}

{% block headline-actions %}
    {% if user.is_authenticated %}
        <form action="{% url "zds.article.views.modify" %}" method="post">
            {% if validation.0 %}
            <h4>{{ validation.0.get_status_display }}</h4>
            {% endif %}

            <div class="mobile-menu-bloc mobile-all-links mobile-show-ico" data-title="Informations">
                <h3><span class="wide">Tags</span></h3>
                {% for category in tags.all %}
                    <h4>{{ category.title }}</h4>
                {% endfor %}
            </div>
            <div class="mobile-menu-bloc mobile-all-links mobile-show-ico" data-title="Informations">
                <h3><span class="wide">Auteurs</span></h3>
                {% for author in authors.all %}
                        {% with profile=author|profile %}
                        <h4><a href="{{ author.get_absolute_url }}">{{ author.username }}</a></h4>
                        {% endwith %}
                {% endfor %}
            </div>

            <div class="mobile-menu-bloc mobile-all-links mobile-show-ico" data-title="Informations">
                <h3><span class="wide">Opérations</span></h3>
            {% if not version = article.sha_validation and not version = article.sha_public and user in authors.all %}
                <h4><a href="{% url "zds.article.views.edit" %}?article={{ article.pk }}">Éditer</a></h4>
                <button type="submit" name="delete">Supprimer</button><br />

                <textarea name="comment" rows="3" placeholder="Vos commentaires de validation"> </textarea>
                <button type="submit" name="pending">Demander la validation</button>
                <button type="submit" name="delete">Confirmer la suppression</button>
            {%endif%}

                <h4><a href="{% url "zds.article.views.history" article.pk article.slug %}">Historique des versions</a></h4>
            </div>

            {% if perms.article.change_article and article.sha_public = version %}
            <div class="mobile-menu-bloc mobile-all-links mobile-show-ico" data-title="Informations">
                <h3><span class="wide">Administration</span></h3>
                <button type="submit" name="invalid-article">Confirmer la dépublication</button>
            </div>
            {% elif perms.article.change_article and article.sha_validation = version %}
            <div class="mobile-menu-bloc mobile-all-links mobile-show-ico" data-title="Informations">
                <h3><span class="wide">Administration</span></h3>
                <textarea name="comment-v" rows="3" placeholder="Vos commentaires de publication"> </textarea>
                <button type="submit" name="valid-article">Confirmer la publication</button>
                <textarea name="comment-r" rows="3" placeholder="Vos commentaires de rejet"> </textarea>
                <button type="submit" name="reject-article">Confirmer le rejet</button>
            </div>
            {% endif %}

            <input type="hidden" name="article" value="{{ article.pk }}" />
            <input type="hidden" name="version" value="{{ version }}" />
            {% csrf_token %}
        </form>
        
    {% endif %}
    <div class="mobile-menu-bloc mobile-all-links mobile-show-ico" data-title="Informations">
        <h3><span class="wide">Télécharger</span></h3>
        <h4><a href="{% url "zds.article.views.download" %}?article={{ article.pk }}">Archive</a></h4>
    </div>
    
{% endblock %}

{% block content %}

{% if article.is_visible %}
    {% include "article/view_pager.part.html" %}
{% endif %}

<div class="row">
    <div class="large-12 columns">
        <div class="large-1 columns hide-for-small">
            {% if article.thumbnail %}
            <img src="{{article.thumbnail.url }}"/>
            {% endif %}
        </div>
        <div>
            {{ article.txt|emarkdown }}
        </div>
    </div>
</div>

{% endblock %}
