<!DOCTYPE html>
<html class="writer-html5" lang="fr" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Le chargement de jeux de données (fixtures) &mdash; Documentation Zeste de Savoir dev</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/translations.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />
    <link rel="next" title="Générer les PDFs des différents contenus" href="generate_pdf.html" />
    <link rel="prev" title="Paramètrer le moteur de Captcha" href="captcha.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Zeste de Savoir
          </a>
              <div class="version">
                dev
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Rechercher docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../guides.html">Guides pas-à-pas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contribuer à Zeste de Savoir</a></li>
<li class="toctree-l1"><a class="reference internal" href="../workflow.html"><em>Workflow</em> et détails pratiques</a></li>
<li class="toctree-l1"><a class="reference internal" href="../back-end.html">Le <em>back-end</em></a></li>
<li class="toctree-l1"><a class="reference internal" href="../back-end-code.html">Documentation technique du <em>back-end</em></a></li>
<li class="toctree-l1"><a class="reference internal" href="../front-end.html">Le <em>front-end</em></a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../utils.html">Makefile et autres outils</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="0-makefile.html">Makefile</a></li>
<li class="toctree-l2"><a class="reference internal" href="adjust_char_count.html">Raffraichir le nombre de caractère d’un contenu</a></li>
<li class="toctree-l2"><a class="reference internal" href="anonym_dislikes.html">Anonymisation des +/-1</a></li>
<li class="toctree-l2"><a class="reference internal" href="captcha.html">Paramètrer le moteur de Captcha</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Le chargement de jeux de données (fixtures)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#chargement-du-jeu-de-donnees-standard">Chargement du jeu de données standard</a></li>
<li class="toctree-l3"><a class="reference internal" href="#les-donnees-serialisables-pour-une-base-fonctionnelle">Les données sérialisables pour une base fonctionnelle</a></li>
<li class="toctree-l3"><a class="reference internal" href="#les-donnees-complexes-voire-les-scenarios">Les données complexes voire les scénarios</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tester-sur-un-jeu-de-donnees-massif">Tester sur un jeu de données massif</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="generate_pdf.html">Générer les PDFs des différents contenus</a></li>
<li class="toctree-l2"><a class="reference internal" href="git-pre-hook.html">Intégration du reformatage du code Python avec Git</a></li>
<li class="toctree-l2"><a class="reference internal" href="nettoyage_alerts.html">Commande de nettoyage des alertes et notifications</a></li>
<li class="toctree-l2"><a class="reference internal" href="opensearch.html">Installer un plugin de recherche à votre navigateur</a></li>
<li class="toctree-l2"><a class="reference internal" href="release_generator.html">Générer les rapports de release</a></li>
<li class="toctree-l2"><a class="reference internal" href="selenium.html">Selenium</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../delay-issue.html">Problème de lenteur lors du dev ?</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Zeste de Savoir</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../utils.html">Makefile et autres outils</a> &raquo;</li>
      <li>Le chargement de jeux de données (fixtures)</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/utils/fixture_loaders.rst.txt" rel="nofollow"> Afficher la source de la page</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="le-chargement-de-jeux-de-donnees-fixtures">
<h1>Le chargement de jeux de données (fixtures)<a class="headerlink" href="#le-chargement-de-jeux-de-donnees-fixtures" title="Lien permanent vers cette rubrique"></a></h1>
<p>Zeste de Savoir étant un projet très complet il est nécessaire de pouvoir charger un ensemble de jeux de données
de manière automatique pour créer une nouvelle instance à des fins de test ou pour forker le site.</p>
<p>Pour faciliter la tâche, des outils sont mis à disposition des développeurs, testeurs et utilisateurs.</p>
<section id="chargement-du-jeu-de-donnees-standard">
<h2>Chargement du jeu de données standard<a class="headerlink" href="#chargement-du-jeu-de-donnees-standard" title="Lien permanent vers cette rubrique"></a></h2>
<p>En l’absence d’exigences particulières, le moyen le plus simple de charger un jeu de données est d’utiliser la
commande suivante :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make generate-fixtures
</pre></div>
</div>
<p>ou si vous souhaitez purger les données existantes au préalable :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make new-db
</pre></div>
</div>
<p>Ces commandes chargent :</p>
<ul class="simple">
<li><p>un jeu de données simples ;</p></li>
<li><p>quelques données plus complexes ;</p></li>
<li><p>un jeu de données modérément massif.</p></li>
</ul>
<p>Ces trois opérations correspondent à des appels aux outils décrits ci-après. Les paramètres exacts sont
disponibles dans le fichier <cite>Makefile</cite> à la racine de l’environnement de développement.</p>
</section>
<section id="les-donnees-serialisables-pour-une-base-fonctionnelle">
<h2>Les données sérialisables pour une base fonctionnelle<a class="headerlink" href="#les-donnees-serialisables-pour-une-base-fonctionnelle" title="Lien permanent vers cette rubrique"></a></h2>
<p>Un premier ensemble de données simples est accessible par la commande intégrée à django <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">loaddata</span></code>.</p>
<p>Cette commande s’attend à une liste de fichiers au format yaml et supporte les <em>wildcards</em>.
Nous possédons un ensemble de données sérialisées dans le dossier fixtures :</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">categories.yaml</span></code> : contient le chargement de 3 catégories de tutoriels, 2 sous-catégories de tutoriels rangées dans les bonnes catégories parentes ;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">forums.yaml</span></code> : contient le chargement de 4 catégories de forum et de 10 forums dans ces catégories ;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">licences.yaml</span></code> : contient le chargement des licences, identiques à celles utilisées en production ;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mps.yaml</span></code> : <strong>nécessite le chargement des users</strong>, contient la création d’un MP d’un membre à un admin ;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">topics.yaml</span></code>: <strong>nécessite le chargement des users</strong>, contient la création de plusieurs topics dans les forums dont un résolu ;</p></li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">users.yaml</span></code>: Crée 6 utilisateurs :</dt><dd><ul>
<li><p>admin/admin avec les droits d’administration</p></li>
<li><p>staff/staff faisant partie du groupe staff</p></li>
<li><p>user/user un utilisateur normal et sans problème</p></li>
<li><p>ïtrema/ïtrema un utilisateur normal, sans problème mais qui aime l’utf8</p></li>
<li><p>Anonymous/anonymous : le compte d’anonymisation</p></li>
<li><p>External/external: le compte pour accueillir les cours externes des auteurs ne voulant pas devenir membre ou quittant le site</p></li>
<li><p>decal/decal: le compte qui possède un identifiant <code class="docutils literal notranslate"><span class="pre">Profile</span></code> différent de l’identifiant <code class="docutils literal notranslate"><span class="pre">user</span></code> pour permettre de tester des cas ou ces id sont différents</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">oauth_applications.yaml</span></code>: crée une application de test <a class="reference external" href="../api.html">pour l’API</a>:</dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">client_id</span></code>: <code class="docutils literal notranslate"><span class="pre">w14aIFqE7z90ti1rXE8hCRMRUOPBP4rXpfLZIKmT</span></code> ;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">client_secret</span></code>: <code class="docutils literal notranslate"><span class="pre">0q4ee800NWs8cSHa0FIbkTLwEncMqYHOCAxNkt9zRmd10bRk1J18TkbviO5QHy2b66ggzyLADm79tJw5BQf2XfApPnk0nogcFaYhtNO33uNlzzT8sXfxu3zzBFu5Wejv</span></code>.</p></li>
</ul>
</dd>
</dl>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">group.yaml</span></code>: crée les descriptions de deux groupes de la page d’accueil (staff et groupe technique).</p></li>
</ul>
</section>
<section id="les-donnees-complexes-voire-les-scenarios">
<h2>Les données complexes voire les scénarios<a class="headerlink" href="#les-donnees-complexes-voire-les-scenarios" title="Lien permanent vers cette rubrique"></a></h2>
<p>Certaines données, pour exister, ont besoin de ressources supplémentaires qui ne sont pas forcément sérialisables.
Par exemple un tutoriel a besoin d’un dépôt git, une option d’aide (ZEP 03) a besoin d’une icône qui sera accessible depuis
le web…</p>
<p>Ces données ont besoin d’être traitées par une routine avant d’être créées. Ces routines existent déjà dans les objets
appelés Factory qui sont dans chacun des fichiers <code class="docutils literal notranslate"><span class="pre">factories.py</span></code> de tous les modules.</p>
<p>Pour utiliser ces fabriques d’objet, vous aurez une nouvelle fois recours au format yaml afin de décrire les
fabriques que vous désirez utiliser ainsi que les paramètres à envoyer auxdites fabriques.</p>
<p>Le format du fichier est celui-ci:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w">   </span><span class="nt">factory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">zds.module.factories.YourFactory</span><span class="w"></span>
<span class="w">    </span><span class="nt">fields</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">champ_string</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;valeur1&quot;</span><span class="w"></span>
<span class="w">        </span><span class="nt">champ_int</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span><span class="w"></span>

<span class="p p-Indicator">-</span><span class="w">   </span><span class="nt">factory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">zds.utils.factories.YourFactory</span><span class="w"></span>
<span class="w">    </span><span class="nt">fields</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">champ_string</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;valeur2&quot;</span><span class="w"></span>
<span class="w">        </span><span class="nt">champ_int</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"></span>
</pre></div>
</div>
<p>Les fichiers de factory déjà existants sont rangés dans le dossier <code class="docutils literal notranslate"><span class="pre">fixtures/advanced</span></code>.</p>
<p>Pour utiliser un fichier yaml de factory, il vous suffit de lancer la commande <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">load_factory_data</span> <span class="pre">chemin_vers_vos_fichier.yaml</span></code>.
Cette méthode est compatible avec les <em>wildcards</em>.</p>
<p>Pour utiliser les factories, il vous faudra vous référer à la documentation de ces dernières puisque les champs associés peuvent
être de deux types :</p>
<ul class="simple">
<li><p>les champs de base qui sont aussi présents avec la même orthographe dans le modèle de données</p></li>
<li><p>les champs personnalisés qui sont faits pour indiquer des comportements complémentaires à la commande
par exemple, avec la zds.utils.HelpWrittingFactory, utiliser <code class="docutils literal notranslate"><span class="pre">fixture_image_path</span></code> vous permettra de renseigner le chemin relatif de l’image dans le dossier <code class="docutils literal notranslate"><span class="pre">fixtures</span></code> plutôt que le chemin absolu.</p></li>
</ul>
<p>Bien que ce module soit optionnel, si vous désirez qu’il soit possible de demander de l’aide sur les tutoriels et articles,
il vous faudra utiliser <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">load_factory_data</span> <span class="pre">fixtures/advanced/aide_tuto_media.yaml</span></code>.</p>
</section>
<section id="tester-sur-un-jeu-de-donnees-massif">
<h2>Tester sur un jeu de données massif<a class="headerlink" href="#tester-sur-un-jeu-de-donnees-massif" title="Lien permanent vers cette rubrique"></a></h2>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>L’utilisation de la commande qui suit peut prendre du temps</p>
</div>
<p>Afin de tester avec un jeu de données qui se rapproche le plus possible de ce qui peut se trouver en exploitation, et aussi
trouver une variété suffisante pour être confiant en vos tests, nous avons développé une commande qui génère une immense
quantité de données.</p>
<p>Pour l’utiliser il suffit de lancer <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">load_fixtures</span> <span class="pre">--size=SIZE</span> <span class="pre">--all</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Vous pouvez ajouter <code class="docutils literal notranslate"><span class="pre">--racine</span></code> qui permet de changer la base pour le nommage des utilisateurs (« user » par défaut).
Vous pouvez ne créer les éléments que d’un module précis (ou de quelques-uns) via des options telles que <code class="docutils literal notranslate"><span class="pre">--forum</span></code>.
Ces options ne sont pas utilisables quand <code class="docutils literal notranslate"><span class="pre">--all</span></code> est ajouté.</p>
</div>
<p>Les types à charger sont en fait les modèles de données qui seront créés.</p>
<p>Chaque modèle de données aura son propre <em>coefficient de création</em> c’est à dire le nombre d’éléments qui seront créés de base.
Ce coefficient sera à multiplier par le <em>coefficient de taille</em> dirrigé par :</p>
<ul class="simple">
<li><p>size=low : <em>coefficient de taille</em> = 1</p></li>
<li><p>size=medium: <em>coefficient de taille</em> = 2</p></li>
<li><p>size=high: <em>coefficient de taille</em> = 3</p></li>
</ul>
<table class="docutils align-default">
<colgroup>
<col style="width: 34%" />
<col style="width: 36%" />
<col style="width: 30%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Modèles créés</p></th>
<th class="head"><p><em>coefficient de création</em></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>member</p></td>
<td><p>Profile (simple membres)</p></td>
<td><p>10</p></td>
</tr>
<tr class="row-odd"><td><p>staff</p></td>
<td><p>Profile (avec droit de staff)</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p>gallery</p></td>
<td><p>Gallery/UserGallery (au hasard)</p></td>
<td><p>1 (par user)</p></td>
</tr>
<tr class="row-odd"><td><p>Image</p></td>
<td><p>3 (par gallery)</p></td>
</tr>
<tr class="row-even"><td><p>category_forum</p></td>
<td><p>forum.Category</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><p>category_content</p></td>
<td><p>utils.Category</p></td>
<td><p>5</p></td>
</tr>
<tr class="row-even"><td><p>utils.SubCategory</p></td>
<td><p>10</p></td>
</tr>
<tr class="row-odd"><td><p>forum</p></td>
<td><p>utils.Forum</p></td>
<td><p>8</p></td>
</tr>
<tr class="row-even"><td><p>tag</p></td>
<td><p>Tag</p></td>
<td><p>30</p></td>
</tr>
<tr class="row-odd"><td><p>topic</p></td>
<td><p>Topic (dont <em>sticky</em> et <em>locked</em>)</p></td>
<td><p>10</p></td>
</tr>
<tr class="row-even"><td><p>post</p></td>
<td><p>Post</p></td>
<td><p>20 (par topic) <a class="footnote-reference brackets" href="#moy" id="id1">2</a></p></td>
</tr>
<tr class="row-odd"><td><p>comment</p></td>
<td><p>ContentReaction</p></td>
<td><p>20 (par contenu) <a class="footnote-reference brackets" href="#moy" id="id2">2</a></p></td>
</tr>
<tr class="row-even"><td><p>tutorial et article</p></td>
<td><p>PublishableContent <a class="footnote-reference brackets" href="#cv2" id="id3">1</a></p></td>
<td><p>10</p></td>
</tr>
</tbody>
</table>
<dl class="footnote brackets">
<dt class="label" id="cv2"><span class="brackets"><a class="fn-backref" href="#id3">1</a></span></dt>
<dd><p>C’est-à-dire 60% en validation (dont 20% réservés) et 30% publiés. S’il sagit de tutoriels, 50% de petits, 30% de moyen et 20% de <em>bigs</em>.</p>
</dd>
<dt class="label" id="moy"><span class="brackets">2</span><span class="fn-backref">(<a href="#id1">1</a>,<a href="#id2">2</a>)</span></dt>
<dd><p>Ce nombre est une moyenne, le nombre réel est choisi au hasard autour de cette moyenne.</p>
</dd>
</dl>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Pied de page">
        <a href="captcha.html" class="btn btn-neutral float-left" title="Paramètrer le moteur de Captcha" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Précédent</a>
        <a href="generate_pdf.html" class="btn btn-neutral float-right" title="Générer les PDFs des différents contenus" accesskey="n" rel="next">Suivant <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2014-2022, Zeste de Savoir.</p>
  </div>

  Compilé avec <a href="https://www.sphinx-doc.org/">Sphinx</a> en utilisant un
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">thème</a>
    fourni par <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>